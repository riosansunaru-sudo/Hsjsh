<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Ù…ÙØ¹Ø±ÙÙ‘Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #FFD700;
  --gold2: #FFA500;
  --gold-dim: #9A7B00;
  --dark: #07070E;
  --darker: #040408;
  --card: #0D0D1C;
  --card2: #12122A;
  --card3: #181835;
  --accent: #FF4500;
  --accent2: #FF6B35;
  --purple: #7C3AED;
  --purple2: #A855F7;
  --blue: #3B82F6;
  --cyan: #06B6D4;
  --text: #E8E8F5;
  --text-dim: #7777AA;
  --green: #00FF88;
  --green2: #00CC6A;
  --red: #FF4466;
  --border: rgba(255,215,0,0.1);
  --border2: rgba(255,255,255,0.06);
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html { scroll-behavior:smooth; }

body {
  background: var(--darker);
  color: var(--text);
  font-family: 'Cairo', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* BG */
body::before {
  content:'';
  position:fixed; inset:0;
  background:
    radial-gradient(ellipse 80% 50% at 50% -10%, rgba(255,215,0,0.06) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 80%, rgba(124,58,237,0.04) 0%, transparent 50%);
  pointer-events:none; z-index:0;
}
body::after {
  content:'';
  position:fixed; inset:0;
  background-image:
    linear-gradient(rgba(255,215,0,0.02) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,215,0,0.02) 1px, transparent 1px);
  background-size:55px 55px;
  pointer-events:none; z-index:0;
}

/* ===== HEADER ===== */
header {
  position:sticky; top:0; z-index:200;
  padding:0.9rem 1.5rem;
  display:flex; justify-content:space-between; align-items:center;
  background:rgba(4,4,8,0.95);
  backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
}
.logo { display:flex; align-items:center; gap:0.8rem; }
.logo-icon {
  width:42px; height:42px;
  background:linear-gradient(135deg, var(--gold), var(--accent));
  border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.3rem;
  box-shadow:0 0 24px rgba(255,215,0,0.3);
  animation:pulse-logo 3s ease-in-out infinite;
  flex-shrink:0;
}
@keyframes pulse-logo {
  0%,100%{box-shadow:0 0 24px rgba(255,215,0,0.3);}
  50%{box-shadow:0 0 44px rgba(255,215,0,0.55);}
}
.logo-text {
  font-family:'Tajawal',sans-serif;
  font-size:1.2rem; font-weight:900;
  background:linear-gradient(90deg, var(--gold), var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
  line-height:1.15;
}
.logo-sub { font-size:0.68rem; color:var(--text-dim); -webkit-text-fill-color:var(--text-dim); }

.header-badges { display:flex; align-items:center; gap:0.5rem; }
.hbadge {
  padding:0.3rem 0.75rem;
  border-radius:999px; font-size:0.72rem; font-weight:700;
  display:flex; align-items:center; gap:0.35rem; white-space:nowrap;
}
.hbadge.ai {
  background:rgba(59,130,246,0.1); border:1px solid rgba(59,130,246,0.3); color:var(--blue);
}
.hbadge.live {
  background:rgba(0,255,136,0.08); border:1px solid rgba(0,255,136,0.25); color:var(--green);
}
.hbadge.live::before {
  content:''; width:6px; height:6px; background:var(--green);
  border-radius:50%; animation:blink 1.5s ease-in-out infinite;
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.15}}

/* PLATFORM TOGGLE */
.platform-wrap {
  position:relative; z-index:5;
  display:flex; justify-content:center; padding:1.8rem 1rem 0.8rem;
}
.platform-tabs {
  display:flex;
  background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:4px; gap:3px;
}
.ptab {
  padding:0.65rem 1.5rem; border-radius:12px; border:none;
  background:transparent; color:var(--text-dim);
  font-family:'Cairo',sans-serif; font-size:0.9rem; font-weight:700;
  cursor:pointer; transition:all 0.3s;
  display:flex; align-items:center; gap:0.45rem; white-space:nowrap;
}
.ptab.pc.active { background:linear-gradient(135deg,rgba(255,215,0,0.18),rgba(255,107,53,0.1)); color:var(--gold); border:1px solid rgba(255,215,0,0.25); }
.ptab.mobile.active { background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(168,85,247,0.15)); color:var(--purple2); border:1px solid rgba(168,85,247,0.28); }
.ptab:not(.active):hover { color:var(--text); background:rgba(255,255,255,0.04); }

/* HERO */
.hero { position:relative; z-index:5; text-align:center; padding:1.5rem 1.5rem 1rem; }
.hero h1 {
  font-family:'Tajawal',sans-serif;
  font-size:clamp(1.7rem,5vw,3.6rem); font-weight:900; line-height:1.2; margin-bottom:0.8rem;
}
.pc-grad { background:linear-gradient(135deg,var(--gold),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.mob-grad { background:linear-gradient(135deg,var(--purple2),#EC4899); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.hero p { color:var(--text-dim); font-size:clamp(0.88rem,2.3vw,1rem); max-width:520px; margin:0 auto 1.2rem; line-height:1.85; font-weight:300; }

.ai-badge-hero {
  display:inline-flex; align-items:center; gap:0.5rem;
  padding:0.45rem 1.1rem;
  background:linear-gradient(135deg,rgba(59,130,246,0.12),rgba(6,182,212,0.08));
  border:1px solid rgba(59,130,246,0.25);
  border-radius:999px; font-size:0.82rem; color:var(--cyan); font-weight:700;
  margin-bottom:1.2rem;
}

/* GAME PILLS */
.games-section { padding:0 1rem 1.2rem; }
.section-label { text-align:center; font-size:0.73rem; color:var(--text-dim); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:0.8rem; font-weight:700; }
.games-scroll { display:flex; gap:0.55rem; padding:0.3rem 0; scrollbar-width:none; flex-wrap:wrap; justify-content:center; }
.games-scroll::-webkit-scrollbar{display:none;}
.game-pill {
  padding:0.38rem 0.9rem; border-radius:999px; font-size:0.8rem;
  white-space:nowrap; transition:all 0.25s; cursor:pointer; font-weight:600; border:1px solid transparent;
}
.game-pill.pc-pill { background:rgba(255,215,0,0.06); border-color:rgba(255,215,0,0.14); color:rgba(255,215,0,0.65); }
.game-pill.pc-pill:hover,.game-pill.pc-pill.active { background:rgba(255,215,0,0.15); border-color:var(--gold-dim); color:var(--gold); transform:translateY(-2px); }
.game-pill.mobile-pill { background:rgba(168,85,247,0.07); border-color:rgba(168,85,247,0.18); color:rgba(168,85,247,0.75); }
.game-pill.mobile-pill:hover,.game-pill.mobile-pill.active { background:rgba(168,85,247,0.18); border-color:var(--purple2); color:var(--purple2); transform:translateY(-2px); }

/* MAIN */
main { position:relative; z-index:5; max-width:900px; margin:0 auto; padding:0 1rem 3rem; }

/* API KEY NOTICE */
.api-notice {
  background:linear-gradient(135deg,rgba(59,130,246,0.08),rgba(6,182,212,0.05));
  border:1px solid rgba(59,130,246,0.2);
  border-radius:16px; padding:1rem 1.2rem; margin-bottom:1.2rem;
  display:flex; align-items:flex-start; gap:0.9rem;
}
.api-notice-icon { font-size:1.5rem; flex-shrink:0; margin-top:0.1rem; }
.api-notice h4 { font-size:0.9rem; font-weight:700; color:var(--cyan); margin-bottom:0.3rem; }
.api-notice p { font-size:0.82rem; color:var(--text-dim); line-height:1.7; }
.api-notice p a { color:var(--blue); text-decoration:none; font-weight:600; }
.api-notice p a:hover { text-decoration:underline; }

.api-key-row {
  display:flex; gap:0.6rem; margin-top:0.7rem; flex-wrap:wrap;
}
.api-key-input {
  flex:1; min-width:200px;
  background:rgba(255,255,255,0.05); border:1px solid rgba(59,130,246,0.2);
  border-radius:10px; padding:0.6rem 0.9rem;
  color:var(--text); font-family:'Cairo',sans-serif; font-size:0.88rem;
  outline:none; transition:border-color 0.3s; direction:ltr;
}
.api-key-input:focus { border-color:var(--blue); }
.api-key-input::placeholder { color:var(--text-dim); }
.save-key-btn {
  padding:0.6rem 1.1rem; border-radius:10px; border:none;
  background:linear-gradient(135deg,var(--blue),var(--cyan));
  color:#fff; font-family:'Cairo',sans-serif; font-size:0.85rem; font-weight:700;
  cursor:pointer; transition:all 0.3s; white-space:nowrap;
}
.save-key-btn:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(59,130,246,0.3); }

.key-status {
  display:flex; align-items:center; gap:0.4rem;
  font-size:0.78rem; font-weight:700; margin-top:0.5rem;
}
.key-status.ok { color:var(--green); }
.key-status.err { color:var(--red); }

/* UPLOAD */
.upload-zone {
  border:2px dashed var(--border); border-radius:20px;
  padding:2.2rem 1.5rem; text-align:center;
  background:var(--card); cursor:pointer;
  transition:all 0.3s; margin-bottom:1rem;
  position:relative; overflow:hidden;
}
.upload-zone::before {
  content:''; position:absolute; inset:0;
  background:radial-gradient(ellipse at center,rgba(255,215,0,0.05) 0%,transparent 70%);
  opacity:0; transition:opacity 0.3s;
}
body.mobile-mode .upload-zone::before { background:radial-gradient(ellipse at center,rgba(168,85,247,0.07) 0%,transparent 70%); }
.upload-zone:hover,.upload-zone.drag-over { border-color:rgba(255,215,0,0.35); }
body.mobile-mode .upload-zone:hover,body.mobile-mode .upload-zone.drag-over { border-color:rgba(168,85,247,0.4); }
.upload-zone:hover::before,.upload-zone.drag-over::before { opacity:1; }
.upload-zone:hover { transform:scale(1.008); }
.upload-icon { font-size:3rem; margin-bottom:0.7rem; display:block; animation:float 4s ease-in-out infinite; }
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
.upload-zone h3 { font-size:1.1rem; font-weight:700; margin-bottom:0.35rem; }
.upload-zone p { color:var(--text-dim); font-size:0.85rem; line-height:1.75; }
.upload-zone p .clickable { color:var(--gold); font-weight:700; cursor:pointer; }
body.mobile-mode .upload-zone p .clickable { color:var(--purple2); }
#fileInput{display:none;}
.file-types { display:flex; gap:0.45rem; justify-content:center; flex-wrap:wrap; margin-top:1rem; }
.ftype {
  padding:0.18rem 0.6rem; border-radius:6px; font-size:0.7rem; font-weight:700;
  background:rgba(255,69,0,0.08); border:1px solid rgba(255,69,0,0.18); color:var(--accent2);
}
body.mobile-mode .ftype { background:rgba(168,85,247,0.08); border-color:rgba(168,85,247,0.22); color:var(--purple2); }

/* DIVIDER */
.or-divider { display:flex; align-items:center; gap:1rem; margin:0.8rem 0; }
.or-divider::before,.or-divider::after { content:''; flex:1; height:1px; background:var(--border2); }
.or-divider span { color:var(--text-dim); font-size:0.8rem; white-space:nowrap; }

/* PASTE */
.paste-area { background:var(--card); border:1px solid var(--border2); border-radius:18px; padding:1.1rem; margin-bottom:1rem; }
.paste-area label { display:block; font-size:0.7rem; color:var(--text-dim); font-weight:700; text-transform:uppercase; letter-spacing:0.06em; margin-bottom:0.5rem; }
.paste-area textarea {
  width:100%; min-height:90px;
  background:rgba(255,255,255,0.03); border:1px solid var(--border2);
  border-radius:10px; padding:0.7rem 0.9rem;
  color:var(--text); font-family:'Cairo',sans-serif; font-size:0.88rem;
  resize:vertical; outline:none; transition:border-color 0.3s; direction:ltr;
}
.paste-area textarea:focus { border-color:var(--gold-dim); }
body.mobile-mode .paste-area textarea:focus { border-color:var(--purple); }
.paste-area textarea::placeholder { color:var(--text-dim); direction:rtl; }
.paste-info { font-size:0.75rem; color:var(--text-dim); margin-top:0.4rem; }
.paste-info span { color:var(--gold); font-weight:600; }
body.mobile-mode .paste-info span { color:var(--purple2); }

/* OPTIONS */
.options-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.85rem; margin-bottom:1rem; }
@media(max-width:540px){ .options-grid{ grid-template-columns:1fr; } }
.option-card {
  background:var(--card); border:1px solid var(--border2);
  border-radius:14px; padding:1rem; transition:all 0.3s;
}
.option-card:hover { border-color:rgba(255,215,0,0.18); background:var(--card2); }
body.mobile-mode .option-card:hover { border-color:rgba(168,85,247,0.25); }
.option-card label { display:block; font-size:0.69rem; color:var(--text-dim); font-weight:700; text-transform:uppercase; letter-spacing:0.06em; margin-bottom:0.5rem; }
.option-card select {
  width:100%; background:rgba(255,255,255,0.04); border:1px solid var(--border2);
  border-radius:9px; padding:0.6rem 0.85rem;
  color:var(--text); font-family:'Cairo',sans-serif; font-size:0.88rem;
  outline:none; transition:border-color 0.3s; direction:rtl;
  -webkit-appearance:none; appearance:none; cursor:pointer;
}
.option-card select:focus { border-color:var(--gold-dim); }
body.mobile-mode .option-card select:focus { border-color:var(--purple); }
.option-card select option { background:#121230; }

/* SPEED SLIDER */
.speed-row { display:flex; align-items:center; gap:0.8rem; }
.speed-slider {
  flex:1; -webkit-appearance:none; appearance:none;
  height:4px; background:var(--border2); border-radius:999px; outline:none;
  cursor:pointer;
}
.speed-slider::-webkit-slider-thumb {
  -webkit-appearance:none; width:16px; height:16px;
  background:var(--gold); border-radius:50%; cursor:pointer;
  box-shadow:0 0 8px rgba(255,215,0,0.5);
}
body.mobile-mode .speed-slider::-webkit-slider-thumb { background:var(--purple2); box-shadow:0 0 8px rgba(168,85,247,0.5); }
.speed-label { font-size:0.8rem; color:var(--gold); font-weight:700; white-space:nowrap; min-width:60px; text-align:left; }
body.mobile-mode .speed-label { color:var(--purple2); }

/* CHUNK SIZE */
.chunk-badges { display:flex; gap:0.4rem; flex-wrap:wrap; }
.chunk-badge {
  padding:0.3rem 0.65rem; border-radius:8px; font-size:0.75rem; font-weight:700;
  cursor:pointer; transition:all 0.2s; border:1px solid var(--border2); color:var(--text-dim);
  background:rgba(255,255,255,0.03);
}
.chunk-badge.active { background:rgba(255,215,0,0.12); border-color:var(--gold-dim); color:var(--gold); }
body.mobile-mode .chunk-badge.active { background:rgba(168,85,247,0.15); border-color:var(--purple2); color:var(--purple2); }

/* TRANSLATE BTN */
.translate-btn {
  width:100%; padding:1.1rem; border:none; border-radius:16px;
  font-family:'Tajawal',sans-serif; font-size:1.15rem; font-weight:900;
  cursor:pointer; transition:all 0.3s; position:relative; overflow:hidden;
  margin-bottom:1.2rem;
  display:flex; align-items:center; justify-content:center; gap:0.6rem;
  background:linear-gradient(135deg,var(--gold),var(--gold2),var(--accent));
  color:#08080F;
  touch-action:manipulation;
  letter-spacing:0.02em;
}
body.mobile-mode .translate-btn {
  background:linear-gradient(135deg,var(--purple),var(--purple2),#EC4899);
  color:#fff;
}
.translate-btn::before {
  content:''; position:absolute; inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,0.25),transparent 60%);
  opacity:0; transition:opacity 0.3s;
}
.translate-btn:hover { transform:translateY(-3px); box-shadow:0 16px 50px rgba(255,215,0,0.35); }
body.mobile-mode .translate-btn:hover { box-shadow:0 16px 50px rgba(168,85,247,0.4); }
.translate-btn:hover::before { opacity:1; }
.translate-btn:active { transform:scale(0.98); }
.translate-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }

/* CANCEL BTN */
.cancel-btn {
  width:100%; padding:0.75rem; border-radius:12px; border:1px solid rgba(255,68,102,0.3);
  background:rgba(255,68,102,0.08); color:var(--red);
  font-family:'Cairo',sans-serif; font-size:0.9rem; font-weight:700;
  cursor:pointer; transition:all 0.3s; margin-bottom:1rem;
  display:none;
}
.cancel-btn.show { display:block; }
.cancel-btn:hover { background:rgba(255,68,102,0.15); border-color:rgba(255,68,102,0.5); }

/* ===== PROGRESS SECTION ===== */
.progress-section {
  display:none; background:var(--card); border:1px solid var(--border2);
  border-radius:20px; padding:1.4rem; margin-bottom:1.2rem; position:relative; overflow:hidden;
}
.progress-section::before {
  content:''; position:absolute; inset:0;
  background:radial-gradient(ellipse at 50% 0%,rgba(255,215,0,0.04),transparent 60%);
  pointer-events:none;
}
body.mobile-mode .progress-section::before { background:radial-gradient(ellipse at 50% 0%,rgba(168,85,247,0.06),transparent 60%); }
.progress-section.show { display:block; animation:fadeIn 0.4s ease; }
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* ETA Row */
.progress-eta-row {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:1rem; flex-wrap:wrap; gap:0.5rem;
}
.progress-title { font-weight:700; font-size:0.95rem; display:flex; align-items:center; gap:0.5rem; }
.progress-title .spin { animation:spin 1s linear infinite; display:inline-block; }
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

.eta-badges { display:flex; gap:0.5rem; flex-wrap:wrap; }
.eta-badge {
  padding:0.28rem 0.7rem; border-radius:8px; font-size:0.78rem; font-weight:700;
  background:rgba(255,215,0,0.08); border:1px solid rgba(255,215,0,0.2); color:var(--gold);
  display:flex; align-items:center; gap:0.3rem;
}
body.mobile-mode .eta-badge { background:rgba(168,85,247,0.1); border-color:rgba(168,85,247,0.25); color:var(--purple2); }
.eta-badge.green { background:rgba(0,255,136,0.08); border-color:rgba(0,255,136,0.25); color:var(--green); }
.eta-badge.blue { background:rgba(59,130,246,0.08); border-color:rgba(59,130,246,0.25); color:var(--blue); }

/* BIG PROGRESS BAR */
.big-progress-wrap { margin-bottom:1rem; }
.big-progress-label { display:flex; justify-content:space-between; margin-bottom:0.4rem; }
.big-progress-label span { font-size:0.8rem; color:var(--text-dim); }
.big-progress-label .pct-num { font-family:'Tajawal',sans-serif; font-size:1.1rem; font-weight:900; color:var(--gold); }
body.mobile-mode .big-progress-label .pct-num { color:var(--purple2); }
.big-progress-bg {
  background:rgba(255,255,255,0.04); border-radius:999px;
  height:12px; overflow:hidden; position:relative;
}
.big-progress-fill {
  height:100%; border-radius:999px; width:0%;
  transition:width 0.4s ease;
  background:linear-gradient(90deg,var(--gold-dim),var(--gold),var(--accent2));
  position:relative;
}
body.mobile-mode .big-progress-fill { background:linear-gradient(90deg,var(--purple),var(--purple2),#EC4899); }
.big-progress-fill::after {
  content:''; position:absolute; top:0; right:0;
  width:80px; height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);
  animation:slide-shine 1.2s ease-in-out infinite;
}
@keyframes slide-shine {
  0%{transform:translateX(80px)} 100%{transform:translateX(-200px)}
}

/* BATCH PROGRESS */
.batch-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(28px,1fr));
  gap:3px; margin-bottom:1rem;
}
.batch-cell {
  height:8px; border-radius:3px;
  background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.04);
  transition:all 0.3s;
}
.batch-cell.done { background:var(--green2); border-color:var(--green); }
.batch-cell.active { background:var(--gold); border-color:var(--gold2); animation:pulse-cell 0.8s ease-in-out infinite; }
body.mobile-mode .batch-cell.active { background:var(--purple2); border-color:var(--purple); }
@keyframes pulse-cell{0%,100%{opacity:1}50%{opacity:0.5}}
.batch-cell.error { background:rgba(255,68,102,0.3); border-color:var(--red); }

/* LIVE LOG */
.live-log {
  background:rgba(0,0,0,0.3); border:1px solid var(--border2);
  border-radius:10px; padding:0.7rem; max-height:100px; overflow-y:auto;
  scrollbar-width:thin; scrollbar-color:var(--border2) transparent;
}
.live-log::-webkit-scrollbar { width:4px; }
.live-log::-webkit-scrollbar-thumb { background:var(--border2); border-radius:999px; }
.log-line { font-size:0.75rem; color:var(--text-dim); line-height:1.6; direction:ltr; }
.log-line.success { color:var(--green2); }
.log-line.active-log { color:var(--gold); }
body.mobile-mode .log-line.active-log { color:var(--purple2); }
.log-line.err-log { color:var(--red); }

/* RESULTS */
.results-section {
  display:none; background:var(--card);
  border:1px solid rgba(0,255,136,0.15);
  border-radius:20px; padding:1.4rem; margin-bottom:1.2rem;
}
.results-section.show { display:block; animation:fadeIn 0.4s ease; }
.results-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:1.1rem; padding-bottom:0.9rem; border-bottom:1px solid var(--border2);
  flex-wrap:wrap; gap:0.5rem;
}
.results-header h3 { font-size:1rem; font-weight:700; }
.result-badges { display:flex; gap:0.5rem; flex-wrap:wrap; }
.rbadge {
  padding:0.25rem 0.7rem; border-radius:999px; font-size:0.75rem; font-weight:700;
}
.rbadge.green { background:rgba(0,255,136,0.08); border:1px solid rgba(0,255,136,0.22); color:var(--green); }
.rbadge.gold { background:rgba(255,215,0,0.08); border:1px solid rgba(255,215,0,0.22); color:var(--gold); }

.result-stats { display:grid; grid-template-columns:repeat(4,1fr); gap:0.7rem; margin-bottom:1.1rem; }
@media(max-width:500px){ .result-stats{ grid-template-columns:repeat(2,1fr); } }
.stat-box {
  background:rgba(255,255,255,0.025); border:1px solid var(--border2);
  border-radius:12px; padding:0.85rem; text-align:center;
}
.stat-box .num {
  font-family:'Tajawal',sans-serif; font-size:1.35rem; font-weight:900;
  color:var(--gold); display:block; line-height:1.1;
}
body.mobile-mode .stat-box .num { color:var(--purple2); }
.stat-box .lbl { font-size:0.7rem; color:var(--text-dim); margin-top:0.2rem; display:block; }

/* TABLE */
.table-wrap { overflow-x:auto; margin-bottom:1.1rem; -webkit-overflow-scrolling:touch; border-radius:12px; border:1px solid var(--border2); }
.preview-table { width:100%; border-collapse:collapse; font-size:0.85rem; min-width:360px; }
.preview-table th {
  background:rgba(255,215,0,0.06); padding:0.6rem 0.85rem;
  text-align:right; font-weight:700; color:var(--gold); border-bottom:1px solid var(--border2);
}
body.mobile-mode .preview-table th { background:rgba(168,85,247,0.07); color:var(--purple2); }
.preview-table th:first-child { text-align:left; }
.preview-table td { padding:0.6rem 0.85rem; border-bottom:1px solid rgba(255,255,255,0.03); vertical-align:top; }
.preview-table td:first-child { color:var(--text-dim); font-size:0.78rem; direction:ltr; text-align:left; max-width:220px; }
.preview-table td:last-child { font-weight:600; }
.preview-table tr:last-child td { border-bottom:none; }
.preview-table tr:hover td { background:rgba(255,255,255,0.02); }
.more-badge {
  text-align:center; padding:0.6rem; font-size:0.8rem; color:var(--text-dim);
  background:rgba(255,255,255,0.02); border-top:1px solid var(--border2);
}

/* DOWNLOAD */
.download-btns { display:flex; gap:0.7rem; flex-wrap:wrap; }
.btn-dl {
  flex:1; min-width:120px; padding:0.75rem 1rem; border-radius:12px;
  font-family:'Cairo',sans-serif; font-size:0.88rem; font-weight:700;
  cursor:pointer; transition:all 0.3s;
  display:flex; align-items:center; justify-content:center; gap:0.4rem;
  touch-action:manipulation;
}
.btn-dl.primary { background:linear-gradient(135deg,var(--gold),var(--accent2)); border:none; color:#0A0A0F; }
body.mobile-mode .btn-dl.primary { background:linear-gradient(135deg,var(--purple),var(--purple2)); color:#fff; }
.btn-dl.secondary { background:transparent; border:1px solid var(--border2); color:var(--text); }
.btn-dl.third { background:rgba(59,130,246,0.08); border:1px solid rgba(59,130,246,0.25); color:var(--blue); }
.btn-dl:hover { transform:translateY(-2px); }
.btn-dl.primary:hover { box-shadow:0 8px 28px rgba(255,215,0,0.28); }
body.mobile-mode .btn-dl.primary:hover { box-shadow:0 8px 28px rgba(168,85,247,0.3); }

/* FEATURES */
.features { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:0.8rem; margin-top:2rem; }
.feat { background:var(--card); border:1px solid var(--border2); border-radius:16px; padding:1.2rem 0.9rem; text-align:center; transition:all 0.3s; }
.feat:hover { border-color:rgba(255,215,0,0.2); transform:translateY(-3px); background:var(--card2); }
.feat-icon { font-size:1.7rem; margin-bottom:0.55rem; display:block; }
.feat h4 { font-size:0.85rem; font-weight:700; margin-bottom:0.3rem; }
.feat p { font-size:0.74rem; color:var(--text-dim); line-height:1.65; }

/* TOAST */
.toast {
  position:fixed; bottom:1.5rem; left:50%;
  transform:translateX(-50%) translateY(80px);
  background:var(--card2); border:1px solid var(--border2);
  border-radius:12px; padding:0.75rem 1.2rem;
  font-size:0.86rem; color:var(--text); z-index:999;
  transition:transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
  white-space:nowrap; max-width:90vw; text-align:center;
}
.toast.show{transform:translateX(-50%) translateY(0);}
.toast.success{border-color:rgba(0,255,136,0.3);}
.toast.error{border-color:rgba(255,68,102,0.35);}
.toast.info{border-color:rgba(59,130,246,0.3);}

footer {
  text-align:center; padding:1.5rem; color:var(--text-dim); font-size:0.78rem;
  border-top:1px solid var(--border2); position:relative; z-index:5;
}

@media(max-width:480px){
  header{padding:0.8rem 0.9rem;}
  .logo-text{font-size:1.05rem;}
  .hbadge{padding:0.25rem 0.6rem;font-size:0.68rem;}
  main{padding:0 0.7rem 2rem;}
  .upload-zone{padding:1.8rem 1rem;}
  .api-notice{flex-direction:column;}
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">ğŸ®</div>
    <div>
      <div class="logo-text">Ù…ÙØ¹Ø±ÙÙ‘Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ AI</div>
      <div class="logo-sub">Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ â€¢ ÙƒÙ„ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
    </div>
  </div>
  <div class="header-badges">
    <div class="hbadge ai">ğŸ¤– Claude AI</div>
    <div class="hbadge live">Ù…Ø¨Ø§Ø´Ø±</div>
  </div>
</header>

<!-- PLATFORM -->
<div class="platform-wrap">
  <div class="platform-tabs">
    <button class="ptab pc active" id="btnPC" onclick="setPlatform('pc')">ğŸ–¥ï¸ ÙƒÙ…Ø¨ÙŠÙˆØªØ±</button>
    <button class="ptab mobile" id="btnMobile" onclick="setPlatform('mobile')">ğŸ“± Ø¬ÙˆØ§Ù„</button>
  </div>
</div>

<!-- HERO -->
<div class="hero">
  <div class="ai-badge-hero">âš¡ Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ù€ Claude AI â€” ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
  <h1 id="heroTitle">Ø¹Ø±ÙÙ‘Ø¨ Ø£Ù„Ø¹Ø§Ø¨Ùƒ<br><span class="pc-grad">Ø¨Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø±Ù‚</span></h1>
  <p id="heroDesc">ØªØ±Ø¬Ù…Ø© Ù…ØªÙˆØ§Ø²ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€” ÙŠØ¹Ø§Ù„Ø¬ Ø¢Ù„Ø§Ù Ø§Ù„Ø£Ø³Ø·Ø± ÙÙŠ Ø«ÙˆØ§Ù†Ù Ù…Ø¹ Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø­ÙŠ Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ø«Ø§Ù†ÙŠØ©</p>
</div>

<!-- PILLS -->
<div class="games-section">
  <div class="section-label">Ø§Ø®ØªØ± Ù„Ø¹Ø¨ØªÙƒ Ø£Ùˆ Ø§Ø±ÙØ¹ Ø£ÙŠ Ù…Ù„Ù â¬‡ï¸</div>
  <div class="games-scroll" id="gamesPills"></div>
</div>

<main>
  <!-- API KEY -->
  <div class="api-notice" id="apiNotice">
    <div class="api-notice-icon">ğŸ”‘</div>
    <div style="flex:1">
      <h4>Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Claude API Ù„Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</h4>
      <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù…Ù† <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> â€” ÙŠÙØ­ÙØ¸ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙØ±Ø³Ù„ Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù… Ø¢Ø®Ø±</p>
      <div class="api-key-row">
        <input type="password" class="api-key-input" id="apiKeyInput" placeholder="sk-ant-api03-..." autocomplete="off">
        <button class="save-key-btn" onclick="saveApiKey()">Ø­ÙØ¸ ÙˆØªÙØ¹ÙŠÙ„</button>
      </div>
      <div class="key-status" id="keyStatus" style="display:none"></div>
    </div>
  </div>

  <!-- UPLOAD -->
  <div class="upload-zone" id="uploadZone">
    <span class="upload-icon" id="uploadIcon">ğŸ“‚</span>
    <h3 id="uploadTitle">Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù‡Ù†Ø§</h3>
    <p id="uploadDesc">Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø£Ùˆ <span class="clickable" onclick="document.getElementById('fileInput').click()">Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</span><br>ÙŠØ¯Ø¹Ù… ÙƒÙ„ ØµÙŠØº Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ù„Ø§ Ø§Ø³ØªØ«Ù†Ø§Ø¡</p>
    <div class="file-types">
      <span class="ftype">.XML</span><span class="ftype">.JSON</span><span class="ftype">.PO/.POT</span>
      <span class="ftype">.STR</span><span class="ftype">.CSV</span><span class="ftype">.TXT</span>
      <span class="ftype">.STRINGS</span><span class="ftype">.XLIFF</span><span class="ftype">.LANG</span><span class="ftype">.INI</span>
    </div>
    <input type="file" id="fileInput" multiple accept="*">
  </div>

  <div class="or-divider"><span>Ø£Ùˆ Ø§Ù„ØµÙ‚ Ø§Ù„Ù†ØµÙˆØµ Ù…Ø¨Ø§Ø´Ø±Ø©</span></div>

  <!-- PASTE -->
  <div class="paste-area">
    <label>ğŸ“ Ø§Ù„ØµÙ‚ Ù†ØµÙˆØµ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Ø£Ùˆ Ø£ÙŠ Ù„ØºØ©)</label>
    <textarea id="pasteText" placeholder="Ù…Ø«Ø§Ù„ â€” Ø§Ù„ØµÙ‚ Ù…Ø¦Ø§Øª Ø§Ù„Ø£Ø³Ø·Ø± Ø¨Ù„Ø§ Ø­Ø¯:
Game Over
Mission Passed! You earned $5000
You are now wanted by the police - 3 stars
WINNER WINNER CHICKEN DINNER!
Enemies nearby - take cover!
New item collected: Desert Eagle"></textarea>
    <div class="paste-info">ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚ <span id="charCount">0</span> Ø­Ø±Ù â€” Ø¨Ù„Ø§ Ø­Ø¯ Ø£Ù‚ØµÙ‰ âœ“</div>
  </div>

  <!-- OPTIONS -->
  <div class="options-grid">
    <div class="option-card">
      <label>ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø© / Ø§Ù„Ù†ÙˆØ¹</label>
      <select id="gameType">
        <option value="auto">ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
        <optgroup label="â”€â”€ Ø£Ù„Ø¹Ø§Ø¨ ÙƒÙ…Ø¨ÙŠÙˆØªØ± â”€â”€">
          <option value="gta5">GTA V</option>
          <option value="rdr2">Red Dead Redemption 2</option>
          <option value="cyberpunk">Cyberpunk 2077</option>
          <option value="witcher3">The Witcher 3</option>
          <option value="skyrim">Skyrim</option>
          <option value="fallout4">Fallout 4</option>
          <option value="eldenring">Elden Ring / Dark Souls</option>
          <option value="minecraft_pc">Minecraft Java</option>
          <option value="cod_pc">Call of Duty PC</option>
          <option value="battlefield">Battlefield Series</option>
          <option value="fifa">FIFA / EA FC</option>
          <option value="fortnite_pc">Fortnite PC</option>
          <option value="valorant">Valorant</option>
          <option value="league">League of Legends</option>
          <option value="dota2">Dota 2</option>
          <option value="overwatch">Overwatch 2</option>
        </optgroup>
        <optgroup label="â”€â”€ Ø£Ù„Ø¹Ø§Ø¨ Ø¬ÙˆØ§Ù„ â”€â”€">
          <option value="pubg_mobile">PUBG Mobile</option>
          <option value="freefire">Free Fire / Garena</option>
          <option value="codmobile">COD Mobile</option>
          <option value="clashofclans">Clash of Clans</option>
          <option value="clashroyale">Clash Royale</option>
          <option value="mobilelegends">Mobile Legends</option>
          <option value="genshin">Genshin Impact</option>
          <option value="honkaisr">Honkai: Star Rail</option>
          <option value="brawlstars">Brawl Stars</option>
          <option value="standoff2">Standoff 2</option>
          <option value="minecraft_pe">Minecraft PE</option>
          <option value="roblox">Roblox</option>
          <option value="fortnite_mobile">Fortnite Mobile</option>
          <option value="arena_of_valor">Arena of Valor</option>
        </optgroup>
        <optgroup label="â”€â”€ Ø£Ù†ÙˆØ§Ø¹ Ø£Ø®Ø±Ù‰ â”€â”€">
          <option value="rpg">RPG / Ù„Ø¹Ø¨Ø© Ø£Ø¯ÙˆØ§Ø±</option>
          <option value="strategy">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</option>
          <option value="horror">Ø±Ø¹Ø¨ / Ø¨Ù‚Ø§Ø¡</option>
          <option value="sports">Ø±ÙŠØ§Ø¶Ø©</option>
          <option value="indie">Ù…Ø³ØªÙ‚Ù„Ø© / Indie</option>
          <option value="vr">ÙˆØ§Ù‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ VR</option>
        </optgroup>
      </select>
    </div>

    <div class="option-card">
      <label>ğŸ—ºï¸ Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
      <select id="dialect">
        <option value="msa">ÙØµØ­Ù‰ Ù…Ø¹ÙŠØ§Ø±ÙŠØ© (Ù…ÙˆØµÙ‰ Ø¨Ù‡)</option>
        <option value="gulf">Ø®Ù„ÙŠØ¬ÙŠ (Ø³Ø¹ÙˆØ¯ÙŠ / Ø¥Ù…Ø§Ø±Ø§ØªÙŠ)</option>
        <option value="levant">Ø´Ø§Ù…ÙŠ (Ø³ÙˆØ±ÙŠ / Ù„Ø¨Ù†Ø§Ù†ÙŠ)</option>
        <option value="egypt">Ù…ØµØ±ÙŠ</option>
        <option value="maghrebi">Ù…ØºØ§Ø±Ø¨ÙŠ</option>
        <option value="iraq">Ø¹Ø±Ø§Ù‚ÙŠ</option>
      </select>
    </div>

    <div class="option-card">
      <label>âœï¸ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ØªØ±Ø¬Ù…Ø©</label>
      <select id="style">
        <option value="natural">Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¹ÙÙˆÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
        <option value="gamer">Ù„ØºØ© Ø¬ÙŠÙ…Ø±Ø² ğŸ”¥</option>
        <option value="formal">Ø±Ø³Ù…ÙŠ ÙˆÙ…Ø­ØªØ±Ù</option>
        <option value="literal">Ø­Ø±ÙÙŠ (Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø£ØµÙ„)</option>
        <option value="creative">Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ ÙˆØ£Ø¯Ø¨ÙŠ</option>
        <option value="teen">Ø´Ø¨Ø§Ø¨ÙŠ ÙˆØ¹Ø§Ù…ÙŠ</option>
      </select>
    </div>

    <div class="option-card">
      <label>âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</label>
      <div style="margin-bottom:0.6rem;">
        <div class="chunk-badges">
          <div class="chunk-badge active" data-size="20" onclick="setChunk(this,20)">Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹</div>
          <div class="chunk-badge" data-size="10" onclick="setChunk(this,10)">Ù…ØªÙˆØ§Ø²Ù†</div>
          <div class="chunk-badge" data-size="5" onclick="setChunk(this,5)">Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©</div>
        </div>
      </div>
      <div class="speed-row">
        <input type="range" class="speed-slider" id="parallelSlider" min="1" max="5" value="3" oninput="updateParallel(this.value)">
        <span class="speed-label" id="parallelLabel">3 Ù…Ø³Ø§Ø±Ø§Øª</span>
      </div>
    </div>
  </div>

  <button class="translate-btn" id="translateBtn" onclick="startTranslation()">
    <span id="btnIcon">ğŸš€</span>
    <span id="btnText">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ø±ÙŠØ¨ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
  </button>
  <button class="cancel-btn" id="cancelBtn" onclick="cancelTranslation()">â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ±Ø¬Ù…Ø©</button>

  <!-- PROGRESS -->
  <div class="progress-section" id="progressSection">
    <div class="progress-eta-row">
      <div class="progress-title">
        <span class="spin">âš¡</span> <span id="progressStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø±ÙŠØ¨...</span>
      </div>
      <div class="eta-badges">
        <div class="eta-badge" id="etaBadge">â± Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨</div>
        <div class="eta-badge green" id="doneBadge">âœ“ 0 / 0</div>
        <div class="eta-badge blue" id="speedBadge">ğŸ”¥ 0 Ø³Ø·Ø±/Ø«</div>
      </div>
    </div>

    <div class="big-progress-wrap">
      <div class="big-progress-label">
        <span id="progressDesc">ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù„ÙØ§Øª...</span>
        <span class="pct-num" id="progressPct">0%</span>
      </div>
      <div class="big-progress-bg">
        <div class="big-progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="batch-grid" id="batchGrid"></div>

    <div class="live-log" id="liveLog">
      <div class="log-line">â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØ±Ø¬Ù…Ø©...</div>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="results-section" id="resultsSection">
    <div class="results-header">
      <h3>ğŸ‰ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!</h3>
      <div class="result-badges">
        <span class="rbadge green">âœ“ Ù…ÙƒØªÙ…Ù„</span>
        <span class="rbadge gold" id="resultGameBadge">ğŸ® Ø¹Ø§Ù…</span>
      </div>
    </div>
    <div class="result-stats">
      <div class="stat-box"><span class="num" id="statLines">0</span><span class="lbl">Ø³Ø·Ø± Ù…ÙØªØ±Ø¬ÙÙ…</span></div>
      <div class="stat-box"><span class="num" id="statWords">0</span><span class="lbl">ÙƒÙ„Ù…Ø© Ø¹Ø±Ø¨ÙŠØ©</span></div>
      <div class="stat-box"><span class="num" id="statTime">0s</span><span class="lbl">ÙˆÙ‚Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©</span></div>
      <div class="stat-box"><span class="num" id="statSpeed">0</span><span class="lbl">Ø³Ø·Ø±/Ø«Ø§Ù†ÙŠØ©</span></div>
    </div>
    <div class="table-wrap">
      <table class="preview-table">
        <thead><tr>
          <th style="text-align:left">Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ</th>
          <th>Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</th>
        </tr></thead>
        <tbody id="previewBody"></tbody>
      </table>
      <div class="more-badge" id="moreBadge" style="display:none"></div>
    </div>
    <div class="download-btns">
      <button class="btn-dl primary" onclick="downloadFile('json')">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ JSON</button>
      <button class="btn-dl third" onclick="downloadFile('txt')">ğŸ“„ ØªÙ†Ø²ÙŠÙ„ TXT</button>
      <button class="btn-dl secondary" onclick="copyAll()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙ„</button>
    </div>
  </div>

  <div class="features">
    <div class="feat"><span class="feat-icon">ğŸ¤–</span><h4>Claude AI Ø­Ù‚ÙŠÙ‚ÙŠ</h4><p>ØªØ±Ø¬Ù…Ø© Ø³ÙŠØ§Ù‚ÙŠØ© ØªÙÙ‡Ù… Ø¹Ø§Ù„Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ´Ø®ØµÙŠØ§ØªÙ‡Ø§</p></div>
    <div class="feat"><span class="feat-icon">âš¡</span><h4>Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…ØªÙˆØ§Ø²ÙŠØ©</h4><p>5 Ù…Ø³Ø§Ø±Ø§Øª ØªØ¹Ù…Ù„ Ù…Ø¹Ø§Ù‹ â€” Ø¢Ù„Ø§Ù Ø§Ù„Ø£Ø³Ø·Ø± ÙÙŠ Ø«ÙˆØ§Ù†Ù</p></div>
    <div class="feat"><span class="feat-icon">ğŸ“Š</span><h4>ØªÙ‚Ø¯Ù… Ø­ÙŠ Ø¨Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h4><p>ÙˆÙ‚Øª Ù…ØªØ¨Ù‚ÙŠ Ø¯Ù‚ÙŠÙ‚ ÙˆØ´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ù…Ø±Ø¦ÙŠ</p></div>
    <div class="feat"><span class="feat-icon">ğŸ®</span><h4>ÙƒÙ„ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h4><p>PC ÙˆØ¬ÙˆØ§Ù„ ÙˆÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù„Ø§ Ø§Ø³ØªØ«Ù†Ø§Ø¡</p></div>
    <div class="feat"><span class="feat-icon">ğŸŒ</span><h4>6 Ù„Ù‡Ø¬Ø§Øª Ø¹Ø±Ø¨ÙŠØ©</h4><p>ÙØµØ­Ù‰ ÙˆØ®Ù„ÙŠØ¬ÙŠ ÙˆØ´Ø§Ù…ÙŠ ÙˆÙ…ØµØ±ÙŠ ÙˆØ¹Ø±Ø§Ù‚ÙŠ ÙˆÙ…ØºØ§Ø±Ø¨ÙŠ</p></div>
    <div class="feat"><span class="feat-icon">ğŸ”’</span><h4>Ù…ÙØªØ§Ø­Ùƒ Ù…Ø­Ù…ÙŠ</h4><p>ÙŠÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· â€” Ù„Ø§ ÙŠÙØ±Ø³Ù„ Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù… Ø¢Ø®Ø±</p></div>
  </div>
</main>

<footer>Ù…ÙØ¹Ø±ÙÙ‘Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ AI â€” Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ù€ Claude Sonnet â€¢ ØµÙ†Ø¹ Ø¨Ù€ â¤ï¸ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¨</footer>
<div class="toast" id="toast"></div>

<script>
// ==================== DATA ====================
const PC_GAMES = [
  {emoji:'ğŸ™ï¸',label:'GTA V',value:'gta5'},
  {emoji:'ğŸ¤ ',label:'RDR2',value:'rdr2'},
  {emoji:'ğŸŒ†',label:'Cyberpunk 2077',value:'cyberpunk'},
  {emoji:'ğŸ—¡ï¸',label:'Witcher 3',value:'witcher3'},
  {emoji:'âš”ï¸',label:'Skyrim',value:'skyrim'},
  {emoji:'ğŸ¹',label:'Elden Ring',value:'eldenring'},
  {emoji:'ğŸ”§',label:'Fallout 4',value:'fallout4'},
  {emoji:'ğŸ¯',label:'Valorant',value:'valorant'},
  {emoji:'ğŸ†',label:'League of Legends',value:'league'},
  {emoji:'âš½',label:'FIFA / EA FC',value:'fifa'},
  {emoji:'ğŸ§±',label:'Minecraft PC',value:'minecraft_pc'},
];
const MOBILE_GAMES = [
  {emoji:'ğŸ”«',label:'PUBG Mobile',value:'pubg_mobile'},
  {emoji:'ğŸ”¥',label:'Free Fire',value:'freefire'},
  {emoji:'ğŸ’¥',label:'COD Mobile',value:'codmobile'},
  {emoji:'ğŸ°',label:'Clash of Clans',value:'clashofclans'},
  {emoji:'ğŸ‘‘',label:'Clash Royale',value:'clashroyale'},
  {emoji:'âš”ï¸',label:'Mobile Legends',value:'mobilelegends'},
  {emoji:'ğŸŒ¸',label:'Genshin Impact',value:'genshin'},
  {emoji:'ğŸŒŸ',label:'Honkai: Star Rail',value:'honkaisr'},
  {emoji:'â­',label:'Brawl Stars',value:'brawlstars'},
  {emoji:'ğŸ¯',label:'Standoff 2',value:'standoff2'},
  {emoji:'ğŸ§±',label:'Minecraft PE',value:'minecraft_pe'},
  {emoji:'ğŸª',label:'Roblox',value:'roblox'},
];

// ==================== STATE ====================
let currentPlatform = 'pc';
let uploadedFiles = [];
let translationResult = [];
let selectedGame = null;
let apiKey = localStorage.getItem('gameTranslatorApiKey') || '';
let chunkSize = 20;
let parallelCount = 3;
let cancelRequested = false;
let startTime = 0;
let totalLines = 0;
let doneLines = 0;
let batches = [];

// ==================== INIT ====================
if (apiKey) {
  document.getElementById('apiKeyInput').value = apiKey;
  showKeyStatus(true, 'Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸ ÙˆÙ…ÙØ¹Ù‘Ù„ âœ“');
}

renderPills(PC_GAMES, 'pc-pill');

document.getElementById('pasteText').addEventListener('input', function() {
  const lines = this.value.split('\n').filter(l=>l.trim()).length;
  document.getElementById('charCount').textContent = lines + ' Ø³Ø·Ø±';
});

// ==================== API KEY ====================
function saveApiKey() {
  const key = document.getElementById('apiKeyInput').value.trim();
  if (!key.startsWith('sk-ant-')) {
    showKeyStatus(false, 'Ù…ÙØªØ§Ø­ ØºÙŠØ± ØµØ­ÙŠØ­ â€” ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ sk-ant-');
    return;
  }
  apiKey = key;
  localStorage.setItem('gameTranslatorApiKey', key);
  showKeyStatus(true, 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØªÙØ¹ÙŠÙ„Ù‡ âœ“');
  showToast('success', 'ğŸ”‘ ØªÙ… Ø­ÙØ¸ Ù…ÙØªØ§Ø­ API Ø¨Ù†Ø¬Ø§Ø­!');
}

function showKeyStatus(ok, msg) {
  const el = document.getElementById('keyStatus');
  el.style.display = 'flex';
  el.className = 'key-status ' + (ok?'ok':'err');
  el.textContent = (ok?'âœ“ ':'âœ— ') + msg;
}

// ==================== PLATFORM ====================
function setPlatform(p) {
  currentPlatform = p;
  document.body.className = p==='mobile'?'mobile-mode':'';
  document.getElementById('btnPC').className = 'ptab pc'+(p==='pc'?' active':'');
  document.getElementById('btnMobile').className = 'ptab mobile'+(p==='mobile'?' active':'');
  if (p==='pc') {
    document.getElementById('heroTitle').innerHTML = 'Ø¹Ø±ÙÙ‘Ø¨ Ø£Ù„Ø¹Ø§Ø¨Ùƒ<br><span class="pc-grad">Ø¨Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø±Ù‚</span>';
    document.getElementById('heroDesc').textContent = 'ØªØ±Ø¬Ù…Ø© Ù…ØªÙˆØ§Ø²ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€” Ø¢Ù„Ø§Ù Ø§Ù„Ø£Ø³Ø·Ø± ÙÙŠ Ø«ÙˆØ§Ù†Ù Ù…Ø¹ ØªÙ‚Ø¯Ù… Ø­ÙŠ Ø¯Ù‚ÙŠÙ‚';
    document.getElementById('uploadIcon').textContent = 'ğŸ“‚';
    document.getElementById('uploadTitle').textContent = 'Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù‡Ù†Ø§';
    document.getElementById('btnText').textContent = 'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ø±ÙŠØ¨ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ';
    document.getElementById('btnIcon').textContent = 'ğŸš€';
    renderPills(PC_GAMES,'pc-pill');
  } else {
    document.getElementById('heroTitle').innerHTML = 'Ø¹Ø±ÙÙ‘Ø¨ Ø£Ù„Ø¹Ø§Ø¨<br><span class="mob-grad">Ø¬ÙˆØ§Ù„Ùƒ ğŸ“±</span>';
    document.getElementById('heroDesc').textContent = 'PUBG â€¢ Free Fire â€¢ COD â€¢ Clash ÙˆÙƒÙ„ Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ â€” ØªØ±Ø¬Ù…Ø© AI ÙÙˆØ±ÙŠØ©';
    document.getElementById('uploadIcon').textContent = 'ğŸ“±';
    document.getElementById('uploadTitle').textContent = 'Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ Ù‡Ù†Ø§';
    document.getElementById('btnText').textContent = 'Ø¹Ø±ÙÙ‘Ø¨ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ';
    document.getElementById('btnIcon').textContent = 'âš¡';
    renderPills(MOBILE_GAMES,'mobile-pill');
  }
  selectedGame = null;
  document.getElementById('gameType').value = 'auto';
  document.getElementById('resultsSection').classList.remove('show');
  document.getElementById('progressSection').classList.remove('show');
}

function renderPills(games, cls) {
  document.getElementById('gamesPills').innerHTML =
    games.map(g=>`<div class="game-pill ${cls}" data-value="${g.value}" onclick="selectPill(this,'${g.value}')">${g.emoji} ${g.label}</div>`).join('');
}

function selectPill(el, value) {
  document.querySelectorAll('.game-pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('gameType').value = value;
  selectedGame = value;
  showToast('success', `âœ… ${el.textContent.trim()}`);
}

function setChunk(el, size) {
  chunkSize = size;
  document.querySelectorAll('.chunk-badge').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

function updateParallel(val) {
  parallelCount = parseInt(val);
  document.getElementById('parallelLabel').textContent = val + ' Ù…Ø³Ø§Ø±Ø§Øª';
}

// ==================== FILE UPLOAD ====================
const zone = document.getElementById('uploadZone');
zone.addEventListener('dragover', e=>{e.preventDefault();zone.classList.add('drag-over');});
zone.addEventListener('dragleave', ()=>zone.classList.remove('drag-over'));
zone.addEventListener('drop', e=>{e.preventDefault();zone.classList.remove('drag-over');handleFiles(e.dataTransfer.files);});
zone.addEventListener('click', ()=>document.getElementById('fileInput').click());
document.getElementById('fileInput').addEventListener('change', e=>handleFiles(e.target.files));

function handleFiles(files) {
  uploadedFiles = Array.from(files);
  if (!uploadedFiles.length) return;
  const totalSize = uploadedFiles.reduce((a,f)=>a+f.size,0);
  const sizeStr = totalSize>1024*1024 ? (totalSize/1024/1024).toFixed(1)+'MB' : Math.round(totalSize/1024)+'KB';
  zone.innerHTML = `
    <span class="upload-icon">âœ…</span>
    <h3>ØªÙ… Ø±ÙØ¹ ${uploadedFiles.length} Ù…Ù„Ù (${sizeStr})</h3>
    <p>${uploadedFiles.map(f=>f.name).slice(0,4).join(' â€¢ ')}<br><span class="clickable" onclick="event.stopPropagation();document.getElementById('fileInput').click()">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª</span></p>
    <div class="file-types">${uploadedFiles.map(f=>`<span class="ftype">${f.name.split('.').pop().toUpperCase()}</span>`).join('')}</div>
    <input type="file" id="fileInput" multiple accept="*" style="display:none">
  `;
  document.getElementById('fileInput').addEventListener('change', e=>handleFiles(e.target.files));
  showToast('success', `âœ… ${uploadedFiles.length} Ù…Ù„Ù â€” ${sizeStr}`);
}

// ==================== TRANSLATION ENGINE ====================
async function startTranslation() {
  const pasteText = document.getElementById('pasteText').value.trim();
  let rawLines = [];

  if (uploadedFiles.length > 0) {
    for (const file of uploadedFiles) {
      try {
        const content = await readFileAsText(file);
        rawLines = rawLines.concat(extractLines(content, file.name));
      } catch(e) {}
    }
  }
  if (pasteText) {
    rawLines = rawLines.concat(pasteText.split('\n').map(l=>l.trim()).filter(l=>l&&l.length>1&&l.length<500));
  }
  if (!rawLines.length) {
    if (selectedGame) {
      rawLines = getDemoLines(document.getElementById('gameType').value);
    } else {
      showToast('error', 'âš ï¸ Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹ Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù†ØµÙˆØµØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹');
      return;
    }
  }

  // Deduplicate
  rawLines = [...new Set(rawLines)];
  totalLines = rawLines.length;
  doneLines = 0;
  cancelRequested = false;
  translationResult = [];
  startTime = Date.now();

  document.getElementById('progressSection').classList.add('show');
  document.getElementById('resultsSection').classList.remove('show');
  document.getElementById('translateBtn').disabled = true;
  document.getElementById('cancelBtn').classList.add('show');

  // Build batch grid
  batches = chunkArray(rawLines, chunkSize);
  buildBatchGrid(batches.length);
  addLog(`ğŸ“¦ ${totalLines} Ø³Ø·Ø± ÙÙŠ ${batches.length} Ø­Ø²Ù…Ø© â€” ${parallelCount} Ù…Ø³Ø§Ø±Ø§Øª Ù…ØªÙˆØ§Ø²ÙŠØ©`, 'active-log');

  if (!apiKey || !apiKey.startsWith('sk-ant-')) {
    addLog('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ API â€” Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ±Ø¬Ù…Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø°ÙƒÙŠØ©', 'err-log');
    await runDemoTranslation(rawLines);
  } else {
    await runRealTranslation(rawLines, batches);
  }
}

// ==================== REAL AI TRANSLATION ====================
async function runRealTranslation(allLines, batches) {
  const gameType = document.getElementById('gameType').value;
  const dialect = document.getElementById('dialect').value;
  const style = document.getElementById('style').value;

  const dialectMap = {msa:'ÙØµØ­Ù‰ Ù…Ø¹ÙŠØ§Ø±ÙŠØ©',gulf:'Ø®Ù„ÙŠØ¬ÙŠØ© Ø³Ø¹ÙˆØ¯ÙŠØ©',levant:'Ø´Ø§Ù…ÙŠØ©',egypt:'Ù…ØµØ±ÙŠØ©',maghrebi:'Ù…ØºØ§Ø±Ø¨ÙŠØ©',iraq:'Ø¹Ø±Ø§Ù‚ÙŠØ©'};
  const styleMap = {natural:'Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¹ÙÙˆÙŠ',gamer:'Ù„ØºØ© Ø¬ÙŠÙ…Ø±Ø² Ø¹Ø±Ø¨ÙŠØ©',formal:'Ø±Ø³Ù…ÙŠ',literal:'Ø­Ø±ÙÙŠ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø£ØµÙ„',creative:'Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ Ø£Ø¯Ø¨ÙŠ',teen:'Ø´Ø¨Ø§Ø¨ÙŠ Ø¹Ø§Ù…ÙŠ'};

  const systemPrompt = `Ø£Ù†Øª Ù…ØªØ±Ø¬Ù… Ù…Ø­ØªØ±Ù Ù…ØªØ®ØµØµ ÙÙŠ Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ. Ù…Ù‡Ù…ØªÙƒ ØªØ±Ø¬Ù…Ø© Ù†ØµÙˆØµ Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.

Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${dialectMap[dialect]||'ÙØµØ­Ù‰'}
Ø§Ù„Ø£Ø³Ù„ÙˆØ¨: ${styleMap[style]||'Ø·Ø¨ÙŠØ¹ÙŠ'}
Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø©: ${gameType==='auto'?'ØºÙŠØ± Ù…Ø­Ø¯Ø¯ (Ø­Ø¯Ø¯Ù‡ Ù…Ù† Ø§Ù„Ø³ÙŠØ§Ù‚)':gameType}

Ù‚ÙˆØ§Ø¹Ø¯ ØµØ§Ø±Ù…Ø©:
1. Ø£Ø±Ø¬Ø¹ JSON ÙÙ‚Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„: {"translations": ["ØªØ±Ø¬Ù…Ø©1", "ØªØ±Ø¬Ù…Ø©2", ...]}
2. Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ³Ø§ÙˆÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø¨Ø§Ù„Ø¶Ø¨Ø·
3. Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù…Ø«Ù„ {0} {1} %s %d ÙƒÙ…Ø§ Ù‡ÙŠ
4. Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ HTML Ù…Ø«Ù„ <br> <b> ÙƒÙ…Ø§ Ù‡Ùˆ
5. Ù„Ø§ ØªØªØ±Ø¬Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª ÙˆØ§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¹Ø¨Ø©
6. Ø§Ø¬Ø¹Ù„ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆØªÙ†Ø§Ø³Ø¨ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©
7. Ù„Ø§ ØªØ¶Ù Ø£ÙŠ Ù†Øµ Ø®Ø§Ø±Ø¬ JSON`;

  let completedBatches = 0;

  // Process in parallel groups
  for (let i = 0; i < batches.length && !cancelRequested; i += parallelCount) {
    const group = batches.slice(i, i + parallelCount);
    const promises = group.map((batch, idx) =>
      translateBatch(batch, i + idx, systemPrompt, allLines)
    );
    await Promise.all(promises);
    completedBatches += group.length;
    updateProgress();
  }

  if (!cancelRequested) {
    finishTranslation(allLines);
  }
}

async function translateBatch(batch, batchIdx, systemPrompt, allLines) {
  if (cancelRequested) return;

  updateBatchCell(batchIdx, 'active');
  addLog(`ğŸ”„ Ø­Ø²Ù…Ø© ${batchIdx+1}: ØªØ±Ø¬Ù…Ø© ${batch.length} Ø³Ø·Ø±...`, 'active-log');

  const userPrompt = `ØªØ±Ø¬Ù… Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠØ©:\n${JSON.stringify(batch)}`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 4096,
        system: systemPrompt,
        messages: [{ role: 'user', content: userPrompt }]
      })
    });

    if (!response.ok) {
      const err = await response.json().catch(()=>({}));
      throw new Error(err.error?.message || `HTTP ${response.status}`);
    }

    const data = await response.json();
    const raw = data.content[0]?.text || '{}';
    const cleaned = raw.replace(/```json|```/g,'').trim();
    const parsed = JSON.parse(cleaned);
    const translations = parsed.translations || [];

    batch.forEach((orig, i) => {
      translationResult.push({ en: orig, ar: translations[i] || orig });
    });

    doneLines += batch.length;
    updateBatchCell(batchIdx, 'done');
    addLog(`âœ“ Ø­Ø²Ù…Ø© ${batchIdx+1}: Ø§ÙƒØªÙ…Ù„Øª (${batch.length} Ø³Ø·Ø±)`, 'success');
    updateProgress();

  } catch(err) {
    addLog(`âœ— Ø­Ø²Ù…Ø© ${batchIdx+1}: Ø®Ø·Ø£ â€” ${err.message}`, 'err-log');
    updateBatchCell(batchIdx, 'error');
    // Fallback: use smart local translation
    batch.forEach(orig => translationResult.push({ en: orig, ar: smartTranslate(orig) }));
    doneLines += batch.length;
    updateProgress();
  }
}

// ==================== DEMO TRANSLATION (no API key) ====================
async function runDemoTranslation(allLines) {
  const batchSize = 15;
  const dBatches = chunkArray(allLines, batchSize);

  for (let i = 0; i < dBatches.length && !cancelRequested; i++) {
    updateBatchCell(i, 'active');
    addLog(`ğŸ”„ Ø­Ø²Ù…Ø© ${i+1}: Ù…Ø¹Ø§Ù„Ø¬Ø© ${dBatches[i].length} Ø³Ø·Ø±...`, 'active-log');
    await sleep(300 + Math.random() * 400);

    dBatches[i].forEach(orig => {
      translationResult.push({ en: orig, ar: smartTranslate(orig) });
    });

    doneLines += dBatches[i].length;
    updateBatchCell(i, 'done');
    addLog(`âœ“ Ø­Ø²Ù…Ø© ${i+1}: Ø§ÙƒØªÙ…Ù„Øª`, 'success');
    updateProgress();
  }

  if (!cancelRequested) finishTranslation(allLines);
}

// ==================== PROGRESS ====================
function updateProgress() {
  const pct = Math.min(Math.round((doneLines / totalLines) * 100), 100);
  const elapsed = (Date.now() - startTime) / 1000;
  const speed = elapsed > 0 ? Math.round(doneLines / elapsed) : 0;
  const remaining = speed > 0 ? Math.ceil((totalLines - doneLines) / speed) : '?';

  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').textContent = pct + '%';
  document.getElementById('progressDesc').textContent = `ØªÙ… ØªØ±Ø¬Ù…Ø© ${doneLines.toLocaleString('ar-EG')} Ù…Ù† ${totalLines.toLocaleString('ar-EG')} Ø³Ø·Ø±`;
  document.getElementById('doneBadge').textContent = `âœ“ ${doneLines} / ${totalLines}`;
  document.getElementById('speedBadge').textContent = `ğŸ”¥ ${speed} Ø³Ø·Ø±/Ø«`;
  document.getElementById('etaBadge').textContent = `â± Ø¨Ø§Ù‚ÙŠ ${remaining}Ø«`;
}

function buildBatchGrid(count) {
  const grid = document.getElementById('batchGrid');
  grid.innerHTML = Array.from({length:count}, (_,i) =>
    `<div class="batch-cell" id="batch-${i}" title="Ø­Ø²Ù…Ø© ${i+1}"></div>`
  ).join('');
}

function updateBatchCell(idx, state) {
  const el = document.getElementById('batch-' + idx);
  if (el) el.className = 'batch-cell ' + state;
}

function addLog(msg, cls='') {
  const log = document.getElementById('liveLog');
  const line = document.createElement('div');
  line.className = 'log-line ' + cls;
  line.textContent = `[${new Date().toLocaleTimeString('ar-EG')}] ${msg}`;
  log.appendChild(line);
  log.scrollTop = log.scrollHeight;
}

function updateProgressStatus(msg) {
  document.getElementById('progressStatus').textContent = msg;
}

// ==================== FINISH ====================
function finishTranslation(allLines) {
  const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
  const speed = Math.round(translationResult.length / elapsed);
  const wordCount = translationResult.reduce((a,p)=>a+(p.ar.split(/\s+/).length),0);
  const gameType = document.getElementById('gameType').value;

  document.getElementById('translateBtn').disabled = false;
  document.getElementById('cancelBtn').classList.remove('show');

  animateNum('statLines', translationResult.length, 800);
  animateNum('statWords', wordCount, 1000);
  document.getElementById('statTime').textContent = elapsed + 'Ø«';
  document.getElementById('statSpeed').textContent = speed.toLocaleString('ar-EG');
  document.getElementById('resultGameBadge').textContent = 'ğŸ® ' + (gameType==='auto'?'ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ':gameType);

  const tbody = document.getElementById('previewBody');
  tbody.innerHTML = '';
  const preview = translationResult.slice(0, 20);
  preview.forEach(p => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escHtml(p.en)}</td><td dir="rtl">${escHtml(p.ar)}</td>`;
    tbody.appendChild(tr);
  });

  if (translationResult.length > 20) {
    const mb = document.getElementById('moreBadge');
    mb.style.display = 'block';
    mb.textContent = `+ ${(translationResult.length-20).toLocaleString('ar-EG')} Ø³Ø·Ø± Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ù…Ù„Ù Ø§Ù„ØªÙ†Ø²ÙŠÙ„`;
  }

  document.getElementById('resultsSection').classList.add('show');
  document.getElementById('resultsSection').scrollIntoView({behavior:'smooth',block:'start'});
  addLog(`ğŸ‰ Ø§ÙƒØªÙ…Ù„! ${translationResult.length} Ø³Ø·Ø± ÙÙŠ ${elapsed}Ø« Ø¨Ø³Ø±Ø¹Ø© ${speed} Ø³Ø·Ø±/Ø«`, 'success');
  showToast('success', `ğŸ‰ ØªÙ… ØªØ¹Ø±ÙŠØ¨ ${translationResult.length.toLocaleString('ar-EG')} Ø³Ø·Ø± ÙÙŠ ${elapsed}Ø«!`);
}

function cancelTranslation() {
  cancelRequested = true;
  addLog('â¹ ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù...', 'err-log');
  document.getElementById('cancelBtn').classList.remove('show');
  document.getElementById('translateBtn').disabled = false;
  if (translationResult.length > 0) {
    finishTranslation([]);
    showToast('info', 'â¹ ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù â€” Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù„ØªÙ†Ø²ÙŠÙ„');
  }
}

// ==================== HELPERS ====================
function extractLines(content, filename) {
  const ext = filename.split('.').pop().toLowerCase();
  let lines = [];

  // JSON
  if (ext === 'json') {
    try {
      const flat = flattenObj(JSON.parse(content));
      lines = Object.values(flat).filter(v=>typeof v==='string'&&v.trim()&&v.length<500);
      return lines;
    } catch(e) {}
  }

  // XML / HTML â€” extract text content
  if (['xml','html','xliff'].includes(ext)) {
    lines = (content.match(/>([^<]{2,300})</g)||[])
      .map(m=>m.replace(/^>|<$/g,'').trim())
      .filter(l=>l&&!/^\d+$/.test(l));
    return [...new Set(lines)];
  }

  // PO files
  if (['po','pot'].includes(ext)) {
    const msgs = content.match(/msgid "(.+?)"/g)||[];
    lines = msgs.map(m=>m.replace(/msgid "/,'').replace(/"$/,'')).filter(l=>l&&l!=='');
    return lines;
  }

  // INI / properties
  if (['ini','properties','lang'].includes(ext)) {
    lines = content.split('\n')
      .map(l=>l.replace(/^[^=]+=\s*/,'').trim())
      .filter(l=>l&&l.length>1&&!/^\[/.test(l));
    return lines;
  }

  // CSV
  if (ext==='csv') {
    lines = content.split('\n')
      .map(l=>l.split(',').pop().replace(/"/g,'').trim())
      .filter(l=>l&&l.length>1);
    return lines;
  }

  // Default: line by line
  lines = content.split('\n')
    .map(l=>l.trim())
    .filter(l=>l&&l.length>1&&l.length<500&&!/^[#;\/\/]/.test(l));
  return lines;
}

function flattenObj(obj, prefix='') {
  return Object.keys(obj).reduce((acc,k)=>{
    const val = obj[k];
    if (typeof val==='object'&&val!==null) Object.assign(acc,flattenObj(val,prefix+k+'.'));
    else acc[prefix+k] = val;
    return acc;
  },{});
}

// Smart local translation (fallback)
const DICT = {
  'game over':'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©','mission passed':'Ø§Ø¬ØªØ²Øª Ø§Ù„Ù…Ù‡Ù…Ø©','mission failed':'ÙØ´Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø©',
  'you died':'Ù„Ù‚Ø¯ Ù…Øª','respawn':'Ø£Ø¹Ø¯ Ø§Ù„Ø¸Ù‡ÙˆØ±','game over':'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©',
  'you are wanted':'Ø£Ù†Øª Ù…Ø·Ù„ÙˆØ¨','wanted':'Ù…Ø·Ù„ÙˆØ¨','police':'Ø§Ù„Ø´Ø±Ø·Ø©','escape':'Ø§Ù‡Ø±Ø¨',
  'inventory full':'Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù…ØªÙ„Ø¦','press start':'Ø§Ø¶ØºØ· Ø¨Ø¯Ø¡','new game':'Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©',
  'save game':'Ø­ÙØ¸ Ø§Ù„Ù„Ø¹Ø¨Ø©','load game':'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©','settings':'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
  'continue':'Ø§Ø³ØªÙ…Ø±Ø§Ø±','exit':'Ø®Ø±ÙˆØ¬','pause':'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª','resume':'Ø§Ø³ØªØ¦Ù†Ø§Ù',
  'health':'Ø§Ù„ØµØ­Ø©','ammo':'Ø°Ø®ÙŠØ±Ø©','money':'Ø§Ù„Ù…Ø§Ù„','level':'Ø§Ù„Ù…Ø³ØªÙˆÙ‰','score':'Ø§Ù„Ù†ØªÙŠØ¬Ø©',
  'lives':'Ø§Ù„Ø£Ø±ÙˆØ§Ø­','bonus':'Ù…ÙƒØ§ÙØ£Ø©','attack':'Ù‡Ø¬ÙˆÙ…','defense':'Ø¯ÙØ§Ø¹','win':'ÙÙˆØ²',
  'lose':'Ø®Ø³Ø§Ø±Ø©','kill':'Ù‚ØªÙ„','shop':'Ø§Ù„Ù…ØªØ¬Ø±','upgrade':'ØªØ·ÙˆÙŠØ±','unlock':'ÙØªØ­',
  'collect':'Ø¬Ù…Ø¹','chest':'ØµÙ†Ø¯ÙˆÙ‚','quest':'Ù…Ù‡Ù…Ø©','enemies nearby':'Ø£Ø¹Ø¯Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©',
  'airdrop':'Ø·Ø±Ø¯ Ø¬ÙˆÙŠ','circle':'Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©','squad':'Ø§Ù„ÙØ±Ù‚Ø©','revive':'Ø¥Ù†Ù‚Ø§Ø°',
  'winner':'Ø§Ù„ÙØ§Ø¦Ø²','chicken dinner':'Ø¹Ø´Ø§Ø¡ Ø¯Ø¬Ø§Ø¬','knocked':'Ø£ÙØ³Ù‚Ø·','eliminated':'Ø£ÙÙ‚ØµÙŠ',
  'booyah':'Ø¨ÙˆÙŠØ§Ù‡','killstreak':'Ø³Ù„Ø³Ù„Ø© Ù‚ØªÙ„','capture':'Ø§Ø­ØªÙ„Ù„','flag':'Ø§Ù„Ø±Ø§ÙŠØ©',
  'maniac':'Ù…Ø¬Ù†ÙˆÙ†','savage':'ÙˆØ­Ø´ÙŠ','legendary':'Ø£Ø³Ø·ÙˆØ±ÙŠ','epic':'Ù…Ù„Ø­Ù…ÙŠ',
  'upgrade complete':'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ·ÙˆÙŠØ±','village under attack':'Ø§Ù„Ù‚Ø±ÙŠØ© ØªØªØ¹Ø±Ø¶ Ù„Ù„Ù‡Ø¬ÙˆÙ…',
  'clan war':'Ø­Ø±Ø¨ Ø§Ù„Ù‚Ø¨ÙŠÙ„Ø©','deploy':'Ø§Ù†Ø´Ø±','troops':'Ø§Ù„Ù‚ÙˆØ§Øª',
  'press':'Ø§Ø¶ØºØ·','tap':'Ø§Ù†Ù‚Ø±','hold':'Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹','release':'Ø£ÙÙ„Øª',
  'start':'Ø¨Ø¯Ø¡','finish':'Ø¥Ù†Ù‡Ø§Ø¡','complete':'Ù…ÙƒØªÙ…Ù„','failed':'ÙØ´Ù„',
  'new':'Ø¬Ø¯ÙŠØ¯','old':'Ù‚Ø¯ÙŠÙ…','best':'Ø§Ù„Ø£ÙØ¶Ù„','next':'Ø§Ù„ØªØ§Ù„ÙŠ','back':'Ø±Ø¬ÙˆØ¹',
};

function smartTranslate(text) {
  const lower = text.toLowerCase();
  for (const [en, ar] of Object.entries(DICT)) {
    if (lower.includes(en)) return text.replace(new RegExp(en,'gi'), ar);
  }
  // Word by word
  const wordMap = {
    mission:'Ù…Ù‡Ù…Ø©',start:'Ø§Ø¨Ø¯Ø£',game:'Ø§Ù„Ù„Ø¹Ø¨Ø©',player:'Ø§Ù„Ù„Ø§Ø¹Ø¨',health:'Ø§Ù„ØµØ­Ø©',
    ammo:'Ø°Ø®ÙŠØ±Ø©',money:'Ø§Ù„Ù…Ø§Ù„',level:'Ø§Ù„Ù…Ø³ØªÙˆÙ‰',save:'Ø­ÙØ¸',load:'ØªØ­Ù…ÙŠÙ„',
    settings:'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',exit:'Ø®Ø±ÙˆØ¬',yes:'Ù†Ø¹Ù…',no:'Ù„Ø§',continue:'Ø§Ø³ØªÙ…Ø±Ø§Ø±',
    score:'Ø§Ù„Ù†ØªÙŠØ¬Ø©',time:'Ø§Ù„ÙˆÙ‚Øª',bonus:'Ù…ÙƒØ§ÙØ£Ø©',attack:'Ù‡Ø¬ÙˆÙ…',win:'ÙÙˆØ²',
    lose:'Ø®Ø³Ø§Ø±Ø©',kill:'Ù‚ØªÙ„',shop:'Ø§Ù„Ù…ØªØ¬Ø±',upgrade:'ØªØ·ÙˆÙŠØ±',chest:'ØµÙ†Ø¯ÙˆÙ‚',
    new:'Ø¬Ø¯ÙŠØ¯',complete:'Ù…ÙƒØªÙ…Ù„',failed:'ÙØ´Ù„',ready:'Ø¬Ø§Ù‡Ø²',loading:'ØªØ­Ù…ÙŠÙ„',
    press:'Ø§Ø¶ØºØ·',tap:'Ø§Ù†Ù‚Ø±',hold:'Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹',confirm:'ØªØ£ÙƒÙŠØ¯',cancel:'Ø¥Ù„ØºØ§Ø¡',
  };
  let result = text;
  for (const [en,ar] of Object.entries(wordMap)) {
    result = result.replace(new RegExp(`\\b${en}\\b`,'gi'), ar);
  }
  return result !== text ? result : `[ØªØ±Ø¬Ù…Ø©] ${text.slice(0,60)}`;
}

function getDemoLines(gameType) {
  const demos = {
    gta5:["You are now wanted by the police!","Mission Passed!","Steal the car","Lose the cops","Inventory full","Respect gained"],
    pubg_mobile:["WINNER WINNER CHICKEN DINNER!","You have been eliminated","Airdrop incoming!","Circle is shrinking","Squad wiped","Revive teammate"],
    generic:["Game Over","Press Start","Save Game","Load Game","Settings","New Game","Continue","Exit","Mission Passed","Mission Failed"],
  };
  return demos[gameType] || demos.generic;
}

// ==================== DOWNLOAD ====================
function downloadFile(format) {
  if (!translationResult.length) return;
  let content, filename, type;

  if (format === 'json') {
    const out = {};
    translationResult.forEach((p,i)=>{ out[`line_${i+1}`]={original:p.en,arabic:p.ar}; });
    content = JSON.stringify(out,null,2);
    filename = `arabic_translation_${currentPlatform}.json`;
    type = 'application/json';
  } else {
    content = translationResult.map(p=>`${p.en}\n${p.ar}\n`).join('\n');
    filename = `arabic_translation_${currentPlatform}.txt`;
    type = 'text/plain;charset=utf-8';
  }

  const blob = new Blob(['\uFEFF'+content],{type});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=filename; a.click();
  URL.revokeObjectURL(url);
  showToast('success','â¬‡ï¸ ØªÙ… Ø§Ù„ØªÙ†Ø²ÙŠÙ„!');
}

function copyAll() {
  if (!translationResult.length) return;
  const text = translationResult.map(p=>`${p.en} â† ${p.ar}`).join('\n');
  navigator.clipboard.writeText(text).then(()=>showToast('success','ğŸ“‹ ØªÙ… Ù†Ø³Ø® '+translationResult.length+' Ø³Ø·Ø±!'));
}

// ==================== UTILS ====================
function animateNum(id, target, dur) {
  const el = document.getElementById(id);
  const step = target/(dur/16); let cur=0;
  const t = setInterval(()=>{
    cur = Math.min(cur+step,target);
    el.textContent = Math.floor(cur).toLocaleString('ar-EG');
    if(cur>=target) clearInterval(t);
  },16);
}

function chunkArray(arr, size) {
  const chunks = [];
  for (let i=0;i<arr.length;i+=size) chunks.push(arr.slice(i,i+size));
  return chunks;
}

function readFileAsText(file) {
  return new Promise((res,rej)=>{
    const r=new FileReader(); r.onload=e=>res(e.target.result); r.onerror=rej; r.readAsText(file,'UTF-8');
  });
}

function showToast(type, msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast ${type} show`;
  setTimeout(()=>t.classList.remove('show'),3500);
}

function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function escHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
</script>
</body>
</html>
